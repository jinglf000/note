{"compress":true,"commitItems":[["74b7d841-70f9-47ce-a01f-8f2038974f24",1522035596683,"",[[1522035575193,["Administrator@PNIN6EWFA74MMDR",[[1,0,"node\n===\n\n\n"]],[0,0],[11,11]]],[1522035582637,["Administrator@PNIN6EWFA74MMDR",[[-1,10,"\n"],[1,11,"### "]],[10,10],[14,14]]],[1522035583303,["Administrator@PNIN6EWFA74MMDR",[[-1,12,"# "]],[14,14],[12,12]]],[1522035586139,["Administrator@PNIN6EWFA74MMDR",[[1,12," koa "]],[12,12],[17,17]]],[1522035587012,["Administrator@PNIN6EWFA74MMDR",[[-1,13,"koa "]],[17,17],[13,13]]],[1522035596050,["Administrator@PNIN6EWFA74MMDR",[[1,13,"理解koa 的洋葱模型"]],[13,13],[24,24]]],[1522035597433,["Administrator@PNIN6EWFA74MMDR",[[1,24,"\n\n"]],[24,24],[25,25]]],[1522035597637,["Administrator@PNIN6EWFA74MMDR",[[1,26,"\n"]],[25,25],[26,26]]],[1522035861923,["Administrator@PNIN6EWFA74MMDR",[[-1,26,"\n"],[1,27,"![]"]],[26,26],[29,29]]],[1522035870656,["Administrator@PNIN6EWFA74MMDR",[[1,28,"koa的洋葱模型"]],[28,28],[36,36]]],[1522035871896,["Administrator@PNIN6EWFA74MMDR",[[1,37,"()"]],[37,37],[39,39]]],[1522035873738,["Administrator@PNIN6EWFA74MMDR",[[1,38,"''"]],[38,38],[40,40]]],[1522035881635,["Administrator@PNIN6EWFA74MMDR",[[1,39,"./imgs/onion."]],[39,39],[52,52]]],[1522035882029,["Administrator@PNIN6EWFA74MMDR",[[-1,51,"."]],[52,52],[51,51]]],[1522035885768,["Administrator@PNIN6EWFA74MMDR",[[1,51,"-model.png"]],[51,51],[61,61]]],[1522035919220,["Administrator@PNIN6EWFA74MMDR",[[-1,38,"'"]],[39,39],[38,38]]],[1522035920293,["Administrator@PNIN6EWFA74MMDR",[[-1,60,"'"]],[61,61],[60,60]]],[1522035945980,["Administrator@PNIN6EWFA74MMDR",[[1,61,"\n\n"]],[61,61],[62,62]]],[1522035947389,["Administrator@PNIN6EWFA74MMDR",[[-1,62,"\n"],[1,63,"···"]],[62,62],[65,65]]],[1522035948168,["Administrator@PNIN6EWFA74MMDR",[[-1,63,"··"]],[65,65],[63,63]]],[1522035948326,["Administrator@PNIN6EWFA74MMDR",[[-1,62,"·"],[1,63,"\n"]],[63,63],[62,62]]],[1522035949881,["Administrator@PNIN6EWFA74MMDR",[[-1,62,"\n"],[1,63,"```js"]],[62,62],[67,67]]],[1522035950083,["Administrator@PNIN6EWFA74MMDR",[[1,67,"\n\n"]],[67,67],[68,68]]],[1522035950894,["Administrator@PNIN6EWFA74MMDR",[[-1,68,"\n"],[1,69,"```"]],[68,68],[71,71]]],[1522035953118,["Administrator@PNIN6EWFA74MMDR",[[1,68,"\n"]],[67,67],[68,68]]],[1522035953621,["Administrator@PNIN6EWFA74MMDR",[[1,69,"\n"]],[68,68],[69,69]]],[1522035963101,["Administrator@PNIN6EWFA74MMDR",[[1,69,"const  Koa  =  require('koa');\n\nconst  app  =  new  Koa();\n\n// 第一层洋葱皮 ctx 为context 上下文\n\napp.use(async  function  appFn1(ctx,  next)  {\n\nconst  start  =  Date.now();\n\nconsole.log(1);\n\nawait  next();\n\nconsole.log(5);\n\nconst  ms  =  Date.now()  -  start;\n\nctx.set('X-Response-Time',  `${ms}ms`);\n\n});\n\n// 第二层洋葱皮\n\napp.use(async  function  appFn2(ctx,  next)  {\n\nconst  start  =  Date.now();\n\nconsole.log(2);\n\nawait  next();\n\nconsole.log(4);\n\nconst  ms  =  Date.now()  -  start;\n\nconsole.log(`${ctx.method}  ${ctx.url} - ${ms}`);\n\n});\n\n// 第三层洋葱皮\n\napp.use(async  function  appFn3(ctx)  {\n\nctx.body  =  'hello World';\n\nconsole.log(3);\n\n});\n\n// 代码的执行顺序是 1 2 3 4 5\n\napp.listen(3000);"]],[69,69],[743,743]]],[1522035967632,["Administrator@PNIN6EWFA74MMDR",[[-1,100,"\n"]],[100,100],[100,100]]],[1522035968539,["Administrator@PNIN6EWFA74MMDR",[[-1,127,"\n"]],[127,127],[127,127]]],[1522035969155,["Administrator@PNIN6EWFA74MMDR",[[-1,154,"\n"]],[154,154],[154,154]]],[1522035969884,["Administrator@PNIN6EWFA74MMDR",[[1,127,"\n"]],[127,127],[128,128]]],[1522035971104,["Administrator@PNIN6EWFA74MMDR",[[-1,202,"\n"]],[202,202],[202,202]]],[1522035971658,["Administrator@PNIN6EWFA74MMDR",[[-1,231,"\n"]],[231,231],[231,231]]],[1522035972322,["Administrator@PNIN6EWFA74MMDR",[[-1,247,"\n"]],[247,247],[247,247]]],[1522035973030,["Administrator@PNIN6EWFA74MMDR",[[-1,262,"\n"]],[262,262],[262,262]]],[1522035977906,["Administrator@PNIN6EWFA74MMDR",[[1,202,"\t"],[1,231,"\t"],[1,247,"\t"],[1,262,"\t"]],[202,278],[202,282]]],[1522035978910,["Administrator@PNIN6EWFA74MMDR",[[-1,282,"\n"]],[282,282],[282,282]]],[1522035979386,["Administrator@PNIN6EWFA74MMDR",[[1,282,"\t"]],[282,282],[283,283]]],[1522035980326,["Administrator@PNIN6EWFA74MMDR",[[-1,319,"\n"]],[319,319],[319,319]]],[1522035980868,["Administrator@PNIN6EWFA74MMDR",[[1,319,"\t"]],[319,319],[320,320]]],[1522035981602,["Administrator@PNIN6EWFA74MMDR",[[-1,360,"\n"]],[360,360],[360,360]]],[1522035983611,["Administrator@PNIN6EWFA74MMDR",[[-1,375,"\n"]],[375,375],[375,375]]],[1522035984729,["Administrator@PNIN6EWFA74MMDR",[[-1,422,"\n"]],[422,422],[422,422]]],[1522035985518,["Administrator@PNIN6EWFA74MMDR",[[-1,451,"\n"]],[451,451],[451,451]]],[1522035986202,["Administrator@PNIN6EWFA74MMDR",[[-1,467,"\n"]],[467,467],[467,467]]],[1522035987263,["Administrator@PNIN6EWFA74MMDR",[[-1,482,"\n"]],[482,482],[482,482]]],[1522035987895,["Administrator@PNIN6EWFA74MMDR",[[-1,498,"\n"]],[498,498],[498,498]]],[1522035988506,["Administrator@PNIN6EWFA74MMDR",[[-1,534,"\n"]],[534,534],[534,534]]],[1522035989093,["Administrator@PNIN6EWFA74MMDR",[[-1,584,"\n"]],[584,584],[584,584]]],[1522035992045,["Administrator@PNIN6EWFA74MMDR",[[1,422,"\t"],[1,451,"\t"],[1,467,"\t"],[1,482,"\t"],[1,498,"\t"]],[422,534],[422,539]]],[1522035992980,["Administrator@PNIN6EWFA74MMDR",[[1,539,"\t"]],[539,539],[540,540]]],[1522035995976,["Administrator@PNIN6EWFA74MMDR",[[-1,646,"\n"]],[646,646],[646,646]]],[1522035997202,["Administrator@PNIN6EWFA74MMDR",[[1,646,"\t"]],[646,646],[647,647]]],[1522035997865,["Administrator@PNIN6EWFA74MMDR",[[-1,675,"\n"]],[675,675],[675,675]]],[1522035998431,["Administrator@PNIN6EWFA74MMDR",[[1,675,"\t"]],[675,675],[676,676]]],[1522035998962,["Administrator@PNIN6EWFA74MMDR",[[-1,692,"\n"]],[692,692],[692,692]]],[1522036002319,["Administrator@PNIN6EWFA74MMDR",[[-1,719,"\n"]],[719,719],[719,719]]],[1522036004392,["Administrator@PNIN6EWFA74MMDR",[[-1,605,"\n"]],[605,605],[605,605]]],[1522036009143,["Administrator@PNIN6EWFA74MMDR",[[1,739,"\n\n"]],[739,739],[740,740]]],[1522036545780,["Administrator@PNIN6EWFA74MMDR",[[-1,740,"\n"],[1,741,"daim"]],[740,740],[744,744]]],[1522036546343,["Administrator@PNIN6EWFA74MMDR",[[-1,741,"aim"]],[744,744],[741,741]]],[1522036546657,["Administrator@PNIN6EWFA74MMDR",[[-1,740,"d"],[1,741,"\n"]],[741,741],[740,740]]],[1522036549620,["Administrator@PNIN6EWFA74MMDR",[[-1,740,"\n"],[1,741,"代码执行舒心"]],[740,740],[746,746]]],[1522036550133,["Administrator@PNIN6EWFA74MMDR",[[-1,744,"舒心"]],[746,746],[744,744]]],[1522036559603,["Administrator@PNIN6EWFA74MMDR",[[1,744,"顺序，next"]],[744,744],[751,751]]],[1522036560889,["Administrator@PNIN6EWFA74MMDR",[[-1,747,"next"]],[751,751],[747,747]]],[1522036586558,["Administrator@PNIN6EWFA74MMDR",[[1,747,"不能保证next()后执行的是否是异步操作，因此在"]],[747,747],[772,772]]],[1522036590027,["Administrator@PNIN6EWFA74MMDR",[[1,747,"住"]],[747,747],[748,748]]],[1522036590764,["Administrator@PNIN6EWFA74MMDR",[[-1,747,"住"]],[748,748],[747,747]]],[1522036594504,["Administrator@PNIN6EWFA74MMDR",[[1,747,"注："]],[747,747],[749,749]]],[1522036602167,["Administrator@PNIN6EWFA74MMDR",[[1,774,"执行时"]],[774,774],[777,777]]],[1522036609354,["Administrator@PNIN6EWFA74MMDR",[[-1,774,"执行时"]],[777,777],[774,774]]],[1522036612523,["Administrator@PNIN6EWFA74MMDR",[[1,774,"next"]],[774,774],[778,778]]],[1522036613502,["Administrator@PNIN6EWFA74MMDR",[[-1,774,"next"]],[778,778],[774,774]]],[1522036618799,["Administrator@PNIN6EWFA74MMDR",[[1,774,"next前要加``"]],[774,774],[783,783]]],[1522036620524,["Administrator@PNIN6EWFA74MMDR",[[1,782,"await"]],[782,782],[787,787]]],[1522036623313,["Administrator@PNIN6EWFA74MMDR",[[1,774,"`"]],[774,774],[775,775]]],[1522036624338,["Administrator@PNIN6EWFA74MMDR",[[1,779,"`"]],[779,779],[780,780]]],[1522036626932,["Administrator@PNIN6EWFA74MMDR",[[1,753,"`"]],[753,753],[754,754]]],[1522036628195,["Administrator@PNIN6EWFA74MMDR",[[1,760,"`"]],[760,760],[761,761]]],[1522036629227,["Administrator@PNIN6EWFA74MMDR",[[1,792,"\n\n"]],[792,792],[793,793]]],[1522036631442,["Administrator@PNIN6EWFA74MMDR",[[-1,793,"\n"],[1,794,"1"]],[793,793],[794,794]]],[1522036632073,["Administrator@PNIN6EWFA74MMDR",[[-1,793,"1"],[1,794,"\n"]],[794,794],[793,793]]],[1522036633027,["Administrator@PNIN6EWFA74MMDR",[[-1,793,"\n"],[1,794,"！{】"]],[793,793],[796,796]]],[1522036633547,["Administrator@PNIN6EWFA74MMDR",[[-1,794,"{】"]],[796,796],[794,794]]],[1522036633922,["Administrator@PNIN6EWFA74MMDR",[[-1,793,"！"],[1,794,"\n"]],[794,794],[793,793]]],[1522036635215,["Administrator@PNIN6EWFA74MMDR",[[-1,793,"\n"],[1,794,"!{}"]],[793,793],[796,796]]],[1522036635903,["Administrator@PNIN6EWFA74MMDR",[[-1,794,"{}"]],[796,796],[794,794]]],[1522036636402,["Administrator@PNIN6EWFA74MMDR",[[1,794,"[]"]],[794,794],[796,796]]],[1522036638186,["Administrator@PNIN6EWFA74MMDR",[[1,795,"dai"]],[795,795],[798,798]]],[1522036638812,["Administrator@PNIN6EWFA74MMDR",[[-1,795,"dai"]],[798,798],[795,795]]],[1522036644939,["Administrator@PNIN6EWFA74MMDR",[[1,795,"上述代码执行舒心"]],[795,795],[803,803]]],[1522036645700,["Administrator@PNIN6EWFA74MMDR",[[-1,801,"舒心"]],[803,803],[801,801]]],[1522036648717,["Administrator@PNIN6EWFA74MMDR",[[1,801,"顺序"]],[801,801],[803,803]]],[1522036650006,["Administrator@PNIN6EWFA74MMDR",[[1,804,"()"]],[804,804],[806,806]]],[1522036652932,["Administrator@PNIN6EWFA74MMDR",[[1,805,"./imgs."]],[805,805],[812,812]]],[1522036653662,["Administrator@PNIN6EWFA74MMDR",[[-1,811,"."]],[812,812],[811,811]]],[1522036654201,["Administrator@PNIN6EWFA74MMDR",[[1,811,"/async-await-sequence.png"]],[811,811],[836,836]]],[1522036660491,["Administrator@PNIN6EWFA74MMDR",[[1,837,";"]],[837,837],[838,838]]],[1522036661421,["Administrator@PNIN6EWFA74MMDR",[[-1,837,";"]],[838,838],[837,837]]],[1522036663352,["Administrator@PNIN6EWFA74MMDR",[[1,837,"\n\n"]],[837,837],[838,838]]],[1522036686282,["Administrator@PNIN6EWFA74MMDR",[[1,13,"1."]],[13,13],[15,15]]],[1522036687012,["Administrator@PNIN6EWFA74MMDR",[[-1,14,"."]],[15,15],[14,14]]],[1522036687539,["Administrator@PNIN6EWFA74MMDR",[[1,14,"、"]],[14,14],[15,15]]],[1522036956899,["Administrator@PNIN6EWFA74MMDR",[[1,795,"\n"]],[794,794],[795,795]]],[1522036957371,["Administrator@PNIN6EWFA74MMDR",[[1,795,"1.  最外层的中间件首先执行。\n2.  调用`next`函数，把执行权交给下一个中间件。\n3.  ...\n4.  最内层的中间件最后执行。\n5.  执行结束后，把执行权交回上一层的中间件。\n6.  ...\n7.  最外层的中间件收回执行权之后，执行`next`函数后面的代码。"]],[795,795],[934,934]]],[1522036960828,["Administrator@PNIN6EWFA74MMDR",[[1,812,"\n"]],[811,811],[812,812]]],[1522036961872,["Administrator@PNIN6EWFA74MMDR",[[-1,812,"\n"]],[812,812],[811,811]]],[1522036963355,["Administrator@PNIN6EWFA74MMDR",[[1,812,"\n"]],[811,811],[812,812]]],[1522036964133,["Administrator@PNIN6EWFA74MMDR",[[-1,812,"\n"]],[812,812],[811,811]]],[1522036965421,["Administrator@PNIN6EWFA74MMDR",[[1,795,"\n"]],[794,794],[795,795]]],[1522036966395,["Administrator@PNIN6EWFA74MMDR",[[1,795,"》"]],[795,795],[796,796]]],[1522036967562,["Administrator@PNIN6EWFA74MMDR",[[-1,795,"》"]],[796,796],[795,795]]],[1522036968368,["Administrator@PNIN6EWFA74MMDR",[[1,795,"> "]],[795,795],[797,797]]],[1522036973614,["Administrator@PNIN6EWFA74MMDR",[[-1,795,">"]],[795,795],[795,795]]],[1522036975135,["Administrator@PNIN6EWFA74MMDR",[[1,797,"> "]],[797,797],[799,799]]],[1522036978069,["Administrator@PNIN6EWFA74MMDR",[[1,816,"\t"]],[816,816],[817,817]]],[1522036980678,["Administrator@PNIN6EWFA74MMDR",[[-1,816,"\t"]],[816,816],[816,816]]],[1522036981781,["Administrator@PNIN6EWFA74MMDR",[[1,816,"》 "]],[816,816],[818,818]]],[1522036982569,["Administrator@PNIN6EWFA74MMDR",[[-1,816,"》 "]],[818,818],[816,816]]],[1522036983822,["Administrator@PNIN6EWFA74MMDR",[[1,816,"> "]],[816,816],[818,818]]],[1522036986535,["Administrator@PNIN6EWFA74MMDR",[[1,847,"> "]],[847,847],[849,849]]],[1522036988026,["Administrator@PNIN6EWFA74MMDR",[[1,857,">"]],[857,857],[858,858]]],[1522036988261,["Administrator@PNIN6EWFA74MMDR",[[1,858," "]],[858,858],[859,859]]],[1522036989607,["Administrator@PNIN6EWFA74MMDR",[[1,876,"> "]],[876,876],[878,878]]],[1522036990989,["Administrator@PNIN6EWFA74MMDR",[[1,903,"> "]],[903,903],[905,905]]],[1522036992894,["Administrator@PNIN6EWFA74MMDR",[[1,913,"> "]],[913,913],[915,915]]]]],["bbbf102d-a0e0-4d66-a8eb-298660f5c4b5",1522155366283,"node\n===\n\n## 1、理解koa 的洋葱模型\n\n![koa的洋葱模型](./imgs/onion-model.png)\n```js\n\nconst  Koa  =  require('koa');\nconst  app  =  new  Koa();\n\n// 第一层洋葱皮 ctx 为context 上下文\napp.use(async  function  appFn1(ctx,  next)  {\n\tconst  start  =  Date.now();\n\tconsole.log(1);\n\tawait  next();\n\tconsole.log(5);\n\tconst  ms  =  Date.now()  -  start;\n\tctx.set('X-Response-Time',  `${ms}ms`);\n});\n\n// 第二层洋葱皮\napp.use(async  function  appFn2(ctx,  next)  {\n\tconst  start  =  Date.now();\n\tconsole.log(2);\n\tawait  next();\n\tconsole.log(4);\n\tconst  ms  =  Date.now()  -  start;\n\tconsole.log(`${ctx.method}  ${ctx.url} - ${ms}`);\n});\n\n// 第三层洋葱皮\napp.use(async  function  appFn3(ctx)  {\n\tctx.body  =  'hello World';\n\tconsole.log(3);\n});\n\n// 代码的执行顺序是 1 2 3 4 5\napp.listen(3000);\n```\n代码执行顺序，注：不能保证`next()`后执行的是否是异步操作，因此在`next`前要加`await`\n \n> 1.  最外层的中间件首先执行。\n> 2.  调用`next`函数，把执行权交给下一个中间件。\n> 3.  ...\n> 4.  最内层的中间件最后执行。\n> 5.  执行结束后，把执行权交回上一层的中间件。\n> 6.  ...\n> 7.  最外层的中间件收回执行权之后，执行`next`函数后面的代码。\n![上述代码执行顺序](./imgs/async-await-sequence.png)\n\n",[[1522155366213,["jinglf@jing-pc",[[1,0,"---\nstyle: candy\n---\n"]],[365,365],[386,386]]],[1522155368634,["jinglf@jing-pc",[[1,11,"o"],[1,12,"e"],[-1,14,"dy"]],[386,386],[386,386]]],[1522155370450,["jinglf@jing-pc",[[-1,11,"ocea"],[1,15,"plai"]],[386,386],[386,386]]],[1522155372609,["jinglf@jing-pc",[[-1,11,"plain"],[1,16,"summer"]],[386,386],[387,387]]],[1522155376010,["jinglf@jing-pc",[[-1,11,"summer"],[1,17,"plain"]],[387,387],[386,386]]],[1522155379497,["jinglf@jing-pc",[[-1,11,"plai"],[1,15,"ocea"]],[386,386],[386,386]]],[1522155388058,["jinglf@jing-pc",[[1,972,"\n"]],[971,971],[972,972]]]]]]}