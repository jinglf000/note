<hr/>
目录：

[TOC]

<hr />



### 1、dev 调试

### 2、Qunar 和 Ctrip 客户端调试

#### 2.1 Qunar模拟器 调试，web页面

首先：确保有一下条件：Mac、Xcode、iphone模拟器、模拟器安装了beta版Qunar客户端；

其次：修改客户端地址为 beta地址，具体修改内容 见 [地址](http://wiki.corp.qunar.com/confluence/pages/viewpage.action?pageId=114448236) 地址需要Qunar 内网登录；（否则地址为线上地址，登录为线上账户）；

最后：登录Qunar客户端，（这时打开页面为登录状态）打开H5 页面，打卡safari - 开发 - 模拟器 - 网页 - 打开控制台，使用 `window.location.href = 'http://xxxxxxx'` 用登录状态打卡页面。

#### 2.2 Ctrip模拟器  调试 web页面

首先：同Qunar 客户端

其次：点击页面悬浮小海豚 - IP/PORT 改为fat 环境；登录时在 [携程消费金融测试工具平台](http://10.5.82.208:8080/) 查询手机验证码登录。在 [wiki地址](http://wiki.corp.qunar.com/confluence/pages/viewpage.action?pageId=144179645) 下载;

最后：登录Ctrip 客户端，打开H5 的页面。使用safari - 开发 -模拟 - 网页 - 控制台 唯一不同的是，携程登录需要跳转空白页；登录地址为 固定地址 + 需要登录的地址（比如betak或者dev）

```js
"http://m.fat1904.qa.nt.ctripcorp.com/webapp/service/financeCenter?isNeedToken=true&subEnv=n&jumpUrl=http%3A%2F%2Fdev.qunar.com%3A7001%2Fm%2Ffinweb%2Fssr%2FfinanceCenter%3FclientSource%3DCTRIP%26from%3DfinanceCenter"
```

注意：地址需要转义


#### 2.3 真机客户端 调试
- [（金融APP&去哪儿&携程）测试账号&短信&环境介绍](http://wiki.corp.qunar.com/confluence/pages/viewpage.action?pageId=213201815) 用于下载 去哪 携程 金融App 安装包
-  去哪儿 beta 客户端下载
  - [下载地址](http://wanshiwu.corp.qunar.com/mobile/packageApp) 
  - 选择历史发版进入，输入tag为beta地址，输出tag为release地址 使用手机扫码安装
  - IOS 版本可以使用扫码下载安装，安卓版本使用手机打开网址下载对应的APP即可。
  - 安卓：下载完成之后，在页面悬浮的 QBUG 上（有悬浮的QUBG表明安装的为beta版本，如果没有打开手机的悬浮权限）在 'ID信息' 里设置 ‘uid’ 为111，即可
- 携程 beta 客户端下载
  - [下载地址](http://mcd.release.ctripcorp.com/mcd/index.html#/index)
  - 选择 集成阶段 -- 集成包列表(选择版本，8.0  如果为空选择更低的版本) – 根据右上角 android或ios进行版本下载。下载时选择测试
  - 如果 对应的版本无列表（计划版本比较靠前），选择更低的版本即可点击页面悬浮小海豚 - IP/PORT 改为fat 环境；登录时在 [携程消费金融测试工具平台](http://10.5.82.208:8080/) 查询手机验证码登录。
  - 参考自 [wiki地址](http://wiki.corp.qunar.com/confluence/pages/viewpage.action?pageId=144179645) ;


###3、 host 部分

去哪儿 App在调试的时候，由于app的限制只能打开qunar域的地址，因此需要修改本机的host文件；（使用switchHost修改）。

- 注1：场景为本地开发在模拟器或者真机中调试，前提已经安装了相应的客户端，客户端安装设置问题可以参考 本文的第二步；

- 注2：device（指的是模拟器和真机）需要安装 chales的证书；Mac 打开charles代理，device和Mac设置为同一wifi环境中（保证能访问），device wifi代理设置为chales 开启的地址（为本地ip + 8888端口，默认）；

- 注3：使用charles时，对于HTTPS请求需要在应用、真机、模拟器中安装charles root 证书，否则无法抓取https的接口；

- 注4：修改host后会出现在浏览起中未生效的情况，那是因为浏览起对host是有缓存的，关闭重新打开一下即可。

- 注5：访问本地的服务有两种方式：本地的实际ip地址，同一网络也能够访问你的服务，使用`127.0.0.1`；有时也通过`localhost`访问，`localhost`之所以能访问是因为host文件中指定了`127.0.0.1 localhost`通常情况下电脑会默认设置；需要注意;

- 注6：修改host文件后，会影响本机访问线上服务，`jr.qunar.com`；

```flow
start=>start: 模拟器、手机开始访问
op1=>operation: device 开始请求
op2=>operation: 请求通过 Mac charles :8888服务，因此charles能够拿到接口的请求
op3=>operation: charles 先通过本机host文件，在通过DNS获取真实访问的ip，因此设置的域名生效
op4=>operation: 访问本地或者其他域的地址，返回内容；
end=>end: 请求结束，获取内容



start->op1->op2->op3->op4->end
```





### 4、QA 问题

1、部署到beta 环境测试时，beta host为什么需要开启？(背景以金融聚合页的next项目为例)

线上地址：https://jr.qunar.com/m/finweb/ssr/financeCenter?clientSource=QUNAR&from=financeCenter 

其中的js资源文件域名为：q.qunarzz.com ;http （80） https（443）;

- next 项目 prod发布版本会在文件夹部分生成唯一的 字符戳，每次文件变动都会生成新的唯一的戳，项目资源文件地址是变化的，因此beta环境需要访问beta环境的文件；
- 而文件访问路径则是网址，这个和线上的地址是一致的，因此在访问时会访问线上的地址，需要手动指定 beta 环境的地址，以便资源访问。